// script.js

const targetCountries = ["ì¤‘êµ­", "ëŸ¬ì‹œì•„", "ì¹´ìíìŠ¤íƒ„", "ìš°ì¦ˆë² í‚¤ìŠ¤íƒ„", "í‚¤ë¥´ê¸°ìŠ¤ìŠ¤íƒ„", "íƒ€ì§€í‚¤ìŠ¤íƒ„", "íˆ¬ë¥´í¬ë©”ë‹ˆìŠ¤íƒ„", "ìš°í¬ë¼ì´ë‚˜", "ë²¨ë¼ë£¨ìŠ¤", "ëª°ë„ë°”"];

// ----------------------------------------------------
// H-2 ë¹„ì ì§„ë‹¨ í•µì‹¬ ë¡œì§ í•¨ìˆ˜
// ----------------------------------------------------
function H2_Check(nationality, age, isDongpoProven, hasForeignRegCard, hasSeriousCrime, hasImmigrationViolation) {
    const result = {
        status: "PASS",
        message: "âœ… H-2 ë¹„ì ì·¨ë“ ê¸°ë³¸ ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.",
        reasons: [],
        requiredDocuments: [],
        procedures: []
    };

    // 1. í•„ìˆ˜ ìš”ê±´ ì²´í¬
    if (!targetCountries.includes(nationality)) {
        result.status = "FAIL";
        result.reasons.push("âŒ êµ­ì  ë¶ˆì¼ì¹˜: H-2 ë¹„ìëŠ” ì›ì¹™ì ìœ¼ë¡œ ì¤‘êµ­/êµ¬ì†Œë ¨ ì§€ì—­ ë™í¬ì—ê²Œ ì œí•œë©ë‹ˆë‹¤.");
    }
    
    if (age < 18) {
        result.status = "FAIL";
        result.reasons.push("âŒ ì—°ë ¹ ë¯¸ë‹¬: ë§Œ 18ì„¸ ë¯¸ë§Œì€ ì·¨ì—… ë¹„ì ì‹ ì²­ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.");
    }
    
    if (!isDongpoProven) {
        result.status = "FAIL";
        result.reasons.push("âŒ ë™í¬ ì…ì¦ ë¶ˆê°€: ê±°ë¯¼ì¦, í˜¸êµ¬ë¶€ ë“±ìœ¼ë¡œ ë™í¬ì„ì„ ì…ì¦í•´ì•¼ í•©ë‹ˆë‹¤.");
    }

    // 2. ê²°ê²© ë° ì£¼ì˜ ìš”ê±´ ì²´í¬ (FAILì´ ì´ë¯¸ ë°œìƒí–ˆìœ¼ë©´ ë©”ì‹œì§€ë§Œ ì¶”ê°€)
    if (hasSeriousCrime) {
        result.status = "FAIL";
        result.reasons.push("âŒ ê²°ê²© ì‚¬ìœ : ì¤‘ëŒ€ ë²”ì£„ ì´ë ¥ì´ í™•ì¸ë˜ì–´ ë¹„ì ë°œê¸‰ì´ ë¶ˆí—ˆë©ë‹ˆë‹¤.");
    }
    
    // WARNING ì²˜ë¦¬
    if (result.status !== "FAIL" && (hasImmigrationViolation || hasForeignRegCard)) {
        result.status = "WARNING";
        result.message = "âš ï¸ H-2 ë¹„ì ì·¨ë“ ì£¼ì˜ (ë³„ë„ ì‹¬ì‚¬ í•„ìš”)";
        
        if (hasImmigrationViolation) {
            result.reasons.push("âš ï¸ ì£¼ì˜: ì¶œì…êµ­ ìœ„ë°˜ ì´ë ¥ì´ ìˆì–´ ë¹„ì ë°œê¸‰ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }
        if (hasForeignRegCard) {
            result.reasons.push("âš ï¸ ì£¼ì˜: ì™¸êµ­ì¸ë“±ë¡ì¦ ì†Œì§€ìëŠ” H-2ë¡œì˜ ì²´ë¥˜ ìê²© ë³€ê²½ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (C-3-8 ë“± ì¼ë¶€ ì˜ˆì™¸ ìˆìŒ)");
        }
    }
    
    // 3. ìµœì¢… PASSì¸ ê²½ìš° ì„œë¥˜ ë° ì ˆì°¨ ì•ˆë‚´
    if (result.status === "PASS" || result.status === "WARNING") {
        result.requiredDocuments = [
            { name: "ì‚¬ì¦ ë°œê¸‰ ì‹ ì²­ì„œ", source: "ë²•ë¬´ë¶€ ì–‘ì‹", note: "ê³µê´€ì— ë¬¸ì˜" },
            { name: "ì—¬ê¶Œ (ì›ë³¸ ë° ì‚¬ë³¸)", source: "í•´ë‹¹ êµ­ê°€ ê¸°ê´€", note: "6ê°œì›” ì´ìƒ ìœ íš¨" },
            { name: "ë™í¬ ì…ì¦ ì„œë¥˜ (í˜¸êµ¬ë¶€, ê±°ë¯¼ì¦ ë“±)", source: "í•´ë‹¹ êµ­ê°€ ê¸°ê´€", note: "ìµœì‹ ë³¸" },
            { name: "ë²”ì£„ ê²½ë ¥ ì¦ëª…ì„œ", source: "í•´ë‹¹ êµ­ê°€ ê¸°ê´€", note: "ë°œê¸‰ì¼ë¡œë¶€í„° 6ê°œì›” ì´ë‚´" },
            { name: "ê±´ê°• ì§„ë‹¨ì„œ (ê²°í•µ ë“±)", source: "ì§€ì • ë³‘ì›", note: "3ê°œì›” ì´ë‚´" }
        ];
        result.procedures = [
            "1. ê¸°ìˆ êµìœ¡ ì‹ ì²­ ë° ì´ìˆ˜ (ë˜ëŠ” í•´ì™¸ ì˜ì‚¬ê´€ ì¶”ì²¨/ì„ ë°œ)",
            "2. ì¬ì™¸ê³µê´€ì— H-2 ì‚¬ì¦ ë°œê¸‰ ì‹ ì²­",
            "3. ì…êµ­ í›„ ì™¸êµ­ì¸ ë“±ë¡ ë° ì·¨ì—…ê°œì‹œ ì‹ ê³ "
        ];
    }

    return result;
}

// ----------------------------------------------------
// DOM ì¡°ì‘ ë° ì´ë²¤íŠ¸ ì²˜ë¦¬
// ----------------------------------------------------

document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('visa-check-form');
    const resultArea = document.getElementById('result-area');
    const finalStatus = document.getElementById('final-status');
    const reasonsList = document.getElementById('reasons-list');
    const requiredInfo = document.getElementById('required-info');
    const documentsList = document.getElementById('documents-list');
    const proceduresList = document.getElementById('procedures-list');
    const resetButton = document.getElementById('reset-button');
    
    const elements = {
        nationality: document.getElementById('nationality'),
        age: document.getElementById('age'),
        is_dongpo_proven: document.getElementById('is_dongpo_proven'),
        has_serious_crime: document.getElementById('has_serious_crime'),
        has_immigration_violation: document.getElementById('has_immigration_violation'),
        has_foreign_reg_card: document.getElementById('has_foreign_reg_card'),
    };

    // ë¹„ê³ (Guidance) ë™ì  ì—…ë°ì´íŠ¸
    function updateGuidance() {
        document.getElementById('guide-nationality').textContent = targetCountries.includes(elements.nationality.value.trim()) ? "âœ… ëŒ€ìƒêµ­ì…ë‹ˆë‹¤." : "H-2 ëŒ€ìƒêµ­ì´ ì•„ë‹ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        document.getElementById('guide-age').textContent = parseInt(elements.age.value) >= 18 ? "âœ… ì·¨ì—… ì—°ë ¹ì…ë‹ˆë‹¤." : "ë§Œ 18ì„¸ ë¯¸ë§Œì€ ì·¨ì—… ë¹„ì ì‹ ì²­ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.";
        document.getElementById('guide-dongpo').textContent = elements.is_dongpo_proven.checked ? "âœ… ë™í¬ ì…ì¦ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤." : "í˜¸êµ¬ë¶€ ë“± ë™í¬ì„ì„ ì…ì¦í•  ì„œë¥˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
        document.getElementById('guide-crime').textContent = elements.has_serious_crime.checked ? "ğŸš¨ ì¤‘ëŒ€ ê²°ê²© ì‚¬ìœ ì…ë‹ˆë‹¤." : "ê²°ê²© ì‚¬ìœ  ì—†ìŒ.";
        document.getElementById('guide-violation').textContent = elements.has_immigration_violation.checked ? "âš ï¸ ë¹„ì ì‹¬ì‚¬ì— ë¶ˆë¦¬í•˜ê²Œ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." : "ìœ„ë°˜ ì´ë ¥ ì—†ìŒ.";
        document.getElementById('guide-regcard').textContent = elements.has_foreign_reg_card.checked ? "âš ï¸ ì²´ë¥˜ ìê²© ë³€ê²½ ì‹œ ì œì•½ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤." : "ì²´ë¥˜ ìƒíƒœ ì í•©.";
    }

    // ì´ˆê¸° ë¡œë“œ ì‹œ ë° ì…ë ¥ ì‹œ ê°€ì´ë“œ ì—…ë°ì´íŠ¸
    Object.values(elements).forEach(el => {
        el.addEventListener('input', updateGuidance);
        el.addEventListener('change', updateGuidance);
    });
    updateGuidance();


    // í¼ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const result = H2_Check(
            elements.nationality.value.trim(),
            parseInt(elements.age.value),
            elements.is_dongpo_proven.checked,
            elements.has_foreign_reg_card.checked,
            elements.has_serious_crime.checked,
            elements.has_immigration_violation.checked
        );

        // ê²°ê³¼ ì˜ì—­ í‘œì‹œ ì„¤ì •
        resultArea.classList.remove('hidden');
        finalStatus.textContent = result.message;
        
        finalStatus.className = 'status-message'; // í´ë˜ìŠ¤ ì´ˆê¸°í™”
        if (result.status === 'PASS') {
            finalStatus.classList.add('status-pass');
        } else if (result.status === 'WARNING') {
            finalStatus.classList.add('status-warning');
        } else {
            finalStatus.classList.add('status-fail');
        }

        // ë¶€ì ê²© ì‚¬ìœ  ë° ì£¼ì˜ ì‚¬í•­ í‘œì‹œ
        reasonsList.innerHTML = result.reasons.map(reason => `<p class="reason">${reason}</p>`).join('');
        
        // ì ê²©/ì£¼ì˜ ì‹œ ì„œë¥˜ ë° ì ˆì°¨ í‘œì‹œ
        if (result.status === 'PASS' || result.status === 'WARNING') {
            requiredInfo.classList.remove('hidden');
            
            // ì„œë¥˜ ëª©ë¡
            documentsList.innerHTML = result.requiredDocuments.map(doc => 
                `<li><strong>${doc.name}</strong> - ë°œê¸‰ì²˜: ${doc.source} (${doc.note})</li>`
            ).join('');

            // ì ˆì°¨ ëª©ë¡
            proceduresList.innerHTML = result.procedures.map(proc => `<li>${proc}</li>`).join('');
        } else {
            requiredInfo.classList.add('hidden');
        }
        
        // ê²°ê³¼ í‘œì‹œ í›„ ìŠ¤í¬ë¡¤
        resultArea.scrollIntoView({ behavior: 'smooth' });
    });
    
    // ìƒˆë¡œ ì…ë ¥í•˜ê¸° ë²„íŠ¼ (ì´ˆê¸°í™”)
    resetButton.addEventListener('click', () => {
        form.reset();
        resultArea.classList.add('hidden');
        updateGuidance(); // ê°€ì´ë“œ ì´ˆê¸°í™”
        window.scrollTo(0, 0); // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
    });
});